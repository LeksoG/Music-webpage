<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Ensure proper scaling on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accessible Red Music Library</title>
  <style>
    /* Global Reset & Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html {
      scroll-behavior: smooth;
    }
    body {
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      background: #121212;
      color: #fff;
      line-height: 1.6;
      overflow: hidden; /* We'll switch screens so no overall scroll */
    }
    a {
      color: #ff1744;
      text-decoration: none;
    }
    a:focus,
    button:focus,
    input:focus,
    select:focus {
      outline: 3px solid #ff1744;
      outline-offset: 2px;
    }
    button {
      cursor: pointer;
      background: none;
      border: none;
      color: inherit;
    }
    /* Skip to content link */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: #ff1744;
      color: #fff;
      padding: 8px 16px;
      z-index: 1000;
      transition: top 0.3s;
    }
    .skip-link:focus {
      top: 0;
    }

    /* ------------------ Screen (Separate Full Page) ------------------ */
    .screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      display: none;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
      padding: 20px;
    }
    .screen.visible {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    /* ------------------ Navigation (Tab Bar) ------------------ */
    header {
      position: fixed;
      width: 100%;
      z-index: 100;
    }
    nav.tab-bar {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      background: rgba(255, 0, 0, 0.25);
      backdrop-filter: blur(10px);
      border-radius: 30px;
      padding: 10px 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }
    nav.tab-bar button {
      background: none;
      border: none;
      color: #fff;
      padding: 12px 20px;
      margin: 0 5px;
      font-size: 16px;
      border-radius: 20px;
      transition: background 0.3s ease;
    }
    nav.tab-bar button:hover,
    nav.tab-bar button:focus,
    nav.tab-bar button.active {
      background: rgba(255, 0, 0, 0.5);
    }

    /* ------------------ Home Screen ------------------ */
    .home-banner {
      background: linear-gradient(45deg, #ff1744, #d50000);
      border-radius: 15px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      margin-bottom: 30px;
    }
    .home-banner h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    .home-banner p {
      font-size: 18px;
    }
    .recent-carousel {
      display: flex;
      gap: 15px;
      overflow-x: auto;
      padding-bottom: 10px;
    }
    .recent-carousel::-webkit-scrollbar {
      display: none;
    }
    .recent-item {
      min-width: 120px;
      height: 120px;
      background: #333;
      border-radius: 10px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }

    /* ------------------ Albums Screen ------------------ */
    .albums-container {
      max-width: 900px;
      margin: auto;
    }
    .album-carousel {
      position: relative;
      margin-bottom: 20px;
      overflow: hidden;
      border-radius: 15px;
    }
    .album-carousel .slides {
      display: flex;
      transition: transform 0.6s ease-in-out;
    }
    .album-carousel .slide {
      min-width: 100%;
      background: rgba(255, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      height: 200px;
    }
    .album-carousel .arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      color: #fff;
      font-size: 24px;
      padding: 5px 10px;
      border-radius: 50%;
      z-index: 10;
    }
    .album-carousel .arrow.left {
      left: 10px;
    }
    .album-carousel .arrow.right {
      right: 10px;
    }
    .album-search {
      text-align: center;
      margin-bottom: 20px;
    }
    .album-search input {
      width: 80%;
      max-width: 400px;
      padding: 10px;
      border-radius: 20px;
      border: none;
      font-size: 16px;
    }
    .album-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
    }
    .album-item {
      background: rgba(255, 0, 0, 0.2);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      position: relative;
      transition: transform 0.2s ease;
      cursor: pointer;
    }
    .album-item:hover {
      transform: scale(1.05);
    }
    .album-item img {
      width: 100%;
      border-radius: 5px;
      margin-bottom: 8px;
    }
    .album-item .play-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .album-item:hover .play-overlay {
      opacity: 1;
    }
    .play-overlay span {
      font-size: 30px;
    }

    /* ------------------ Artists Screen ------------------ */
    .artists-container {
      max-width: 900px;
      margin: auto;
    }
    .artist-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .artist-card {
      background: rgba(255, 0, 0, 0.2);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      transition: transform 0.2s ease;
      cursor: pointer;
    }
    .artist-card:hover {
      transform: scale(1.05);
    }
    .artist-card img {
      width: 100%;
      border-radius: 50%;
      height: 100px;
      object-fit: cover;
      margin-bottom: 10px;
    }
    .artist-card h3 {
      font-size: 16px;
    }

    /* ------------------ Playlists Screen ------------------ */
    .playlists-container {
      max-width: 900px;
      margin: auto;
    }
    .playlists-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .playlists-header h2 {
      font-size: 22px;
    }
    .add-playlist {
      background: #ff1744;
      padding: 8px 15px;
      border-radius: 20px;
      color: #fff;
      transition: background 0.3s ease;
    }
    .add-playlist:hover {
      background: #d50000;
    }
    .playlists-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
    }
    .playlist-card {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 10px;
      width: calc(33.333% - 10px);
      min-width: 150px;
      position: relative;
      transition: transform 0.2s ease;
      cursor: move;
    }
    .playlist-card:hover {
      transform: scale(1.03);
    }
    .playlist-card img {
      width: 100%;
      border-radius: 5px;
      margin-bottom: 8px;
    }
    .playlist-card h4 {
      margin: 10px 0 5px;
      font-size: 16px;
    }
    .playlist-card p {
      font-size: 14px;
      color: #ccc;
    }
    .playlist-card .edit-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(0,0,0,0.6);
      padding: 4px 6px;
      border-radius: 4px;
      font-size: 12px;
      display: none;
      cursor: pointer;
    }
    .playlist-card:focus-within .edit-btn,
    .playlist-card:hover .edit-btn {
      display: block;
    }

    /* ------------------ Modals & Overlay ------------------ */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      z-index: 150;
    }
    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 500px;
      background: #222;
      padding: 20px;
      border-radius: 10px;
      z-index: 200;
      display: none;
      flex-direction: column;
      align-items: center;
    }
    .modal h3 {
      margin-bottom: 10px;
    }
    .modal p {
      margin-bottom: 15px;
    }
    .modal button {
      margin-top: 10px;
      padding: 8px 12px;
      border-radius: 5px;
      width: 100%;
    }
    .modal .confirm {
      background: #ff1744;
      color: #fff;
    }
    .modal .cancel {
      background: #555;
      color: #fff;
      margin-top: 5px;
    }
    /* Advanced Playlist Modal Styles */
    .modal.playlist-modal {
      max-width: 450px;
    }
    .modal.playlist-modal label {
      align-self: flex-start;
      margin: 5px 0 0 5px;
      font-size: 14px;
      color: #ccc;
    }
    .modal.playlist-modal input,
    .modal.playlist-modal textarea,
    .modal.playlist-modal select {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    .modal.playlist-modal .cover-preview {
      width: 100%;
      max-height: 200px;
      margin: 10px 0;
      border-radius: 5px;
      background: #333;
      background-size: cover;
      background-position: center;
      display: none;
    }
    .modal.playlist-modal .toggle-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 8px 0;
      width: 100%;
    }
    .modal.playlist-modal .toggle-group input[type="checkbox"] {
      transform: scale(1.2);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- Skip Link for Accessibility -->
  <a href="#mainContent" class="skip-link">Skip to content</a>

  <!-- Header & Fixed Navigation (Tab Bar) -->
  <header>
    <nav class="tab-bar" aria-label="Main Navigation">
      <button onclick="switchScreen('home')" id="btn-home" class="active">Home</button>
      <button onclick="switchScreen('albums')" id="btn-albums">Albums</button>
      <button onclick="switchScreen('artists')" id="btn-artists">Artists</button>
      <button onclick="switchScreen('playlists')" id="btn-playlists">Playlists</button>
    </nav>
  </header>

  <!-- Main Content: Each section is a full-screen "screen" -->
  <main id="mainContent">
    <!-- Home Screen -->
    <section id="home" class="screen visible" role="region" aria-labelledby="homeHeading">
      <div class="home-banner">
        <h1 id="homeHeading" tabindex="0">Welcome!</h1>
        <p>Your personal music library</p>
      </div>
      <div class="recent-carousel" aria-label="Recently Played Albums">
        <div class="recent-item" tabindex="0">Album A</div>
        <div class="recent-item" tabindex="0">Album B</div>
        <div class="recent-item" tabindex="0">Album C</div>
        <div class="recent-item" tabindex="0">Album D</div>
      </div>
    </section>

    <!-- Albums Screen -->
    <section id="albums" class="screen" role="region" aria-labelledby="albumsHeading">
      <div class="albums-container">
        <h2 id="albumsHeading" tabindex="0">Featured Albums</h2>
        <div class="album-carousel">
          <button class="arrow left" onclick="prevSlide()" aria-label="Previous Slide">&#8249;</button>
          <div class="slides" id="albumSlides">
            <div class="slide" tabindex="0">Featured Album 1</div>
            <div class="slide" tabindex="0">Featured Album 2</div>
            <div class="slide" tabindex="0">Featured Album 3</div>
          </div>
          <button class="arrow right" onclick="nextSlide()" aria-label="Next Slide">&#8250;</button>
        </div>
        <div class="album-search">
          <input type="text" id="albumSearch" placeholder="Search albums..." onkeyup="filterAlbums()" aria-label="Search Albums" />
        </div>
        <div class="album-grid" id="albumGrid">
          <div class="album-item" data-title="Album One" onclick="openAlbumModal('Album One', 'This is the first album.')" tabindex="0">
            Album One
            <div class="play-overlay"><span aria-hidden="true">&#9658;</span></div>
          </div>
          <div class="album-item" data-title="Album Two" onclick="openAlbumModal('Album Two', 'This is the second album.')" tabindex="0">
            Album Two
            <div class="play-overlay"><span aria-hidden="true">&#9658;</span></div>
          </div>
          <div class="album-item" data-title="Album Three" onclick="openAlbumModal('Album Three', 'This is the third album.')" tabindex="0">
            Album Three
            <div class="play-overlay"><span aria-hidden="true">&#9658;</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Artists Screen -->
    <section id="artists" class="screen" role="region" aria-labelledby="artistsHeading">
      <div class="artists-container">
        <h2 id="artistsHeading" tabindex="0">Artists</h2>
        <div class="artist-grid">
          <div class="artist-card" onclick="openArtistModal('Artist A')" tabindex="0">
            <img src="https://via.placeholder.com/100/ff1744/ffffff?text=A" alt="Artist A" />
            <h3>Artist A</h3>
          </div>
          <div class="artist-card" onclick="openArtistModal('Artist B')" tabindex="0">
            <img src="https://via.placeholder.com/100/d50000/ffffff?text=B" alt="Artist B" />
            <h3>Artist B</h3>
          </div>
          <div class="artist-card" onclick="openArtistModal('Artist C')" tabindex="0">
            <img src="https://via.placeholder.com/100/ff1744/ffffff?text=C" alt="Artist C" />
            <h3>Artist C</h3>
          </div>
        </div>
      </div>
    </section>

    <!-- Playlists Screen -->
    <section id="playlists" class="screen" role="region" aria-labelledby="playlistsHeading">
      <div class="playlists-container">
        <div class="playlists-header">
          <h2 id="playlistsHeading" tabindex="0">Your Playlists</h2>
          <button class="add-playlist" onclick="openPlaylistModal()" aria-label="Add Playlist">+ Add Playlist</button>
        </div>
        <div class="playlists-grid" id="playlistsGrid">
          <div class="playlist-card" draggable="true" ondragstart="drag(event)" id="playlist-1" tabindex="0">
            <button class="edit-btn" onclick="editPlaylist(event, 'playlist-1')" aria-label="Edit Playlist">Edit</button>
            <h4>Chill Vibes</h4>
            <p>Relaxing tunes</p>
          </div>
          <div class="playlist-card" draggable="true" ondragstart="drag(event)" id="playlist-2" tabindex="0">
            <button class="edit-btn" onclick="editPlaylist(event, 'playlist-2')" aria-label="Edit Playlist">Edit</button>
            <h4>Workout Mix</h4>
            <p>High energy</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- ------------------ Modals & Overlays ------------------ -->
  <div class="overlay" id="overlay" onclick="closeAllModals()" tabindex="-1"></div>

  <!-- Artist Modal -->
  <div class="modal artist-modal" id="artistModal" role="dialog" aria-labelledby="artistModalTitle" aria-modal="true">
    <h3 id="artistModalTitle">Artist Name</h3>
    <p>Top Songs:</p>
    <ul id="artistSongs"></ul>
    <button class="confirm" onclick="closeArtistModal()">Close</button>
  </div>

  <!-- Album Modal -->
  <div class="modal album-modal" id="albumModal" role="dialog" aria-labelledby="albumModalTitle" aria-modal="true">
    <h3 id="albumModalTitle">Album Title</h3>
    <p id="albumDesc">Album details and description here.</p>
    <button onclick="playAlbum()">Play Album</button>
    <button class="cancel" onclick="closeAlbumModal()">Close</button>
  </div>

  <!-- Advanced Playlist Modal -->
  <div class="modal playlist-modal" id="playlistModal" role="dialog" aria-labelledby="playlistModalTitle" aria-modal="true">
    <h3 id="playlistModalTitle">Create New Playlist</h3>
    <label for="newPlaylistName">Playlist Name</label>
    <input type="text" id="newPlaylistName" placeholder="Enter playlist name" />
    
    <label for="newPlaylistDesc">Description</label>
    <textarea id="newPlaylistDesc" placeholder="Enter playlist description"></textarea>
    
    <label for="newPlaylistCover">Cover Image</label>
    <input type="file" id="newPlaylistCover" accept="image/*" onchange="previewCover(this)" />
    <div class="cover-preview" id="coverPreview" aria-hidden="true"></div>
    
    <label for="newPlaylistGenre">Genre</label>
    <select id="newPlaylistGenre">
      <option value="">Select Genre</option>
      <option>Pop</option>
      <option>Rock</option>
      <option>Hip-Hop</option>
      <option>Electronic</option>
      <option>Jazz</option>
    </select>
    
    <div class="toggle-group">
      <input type="checkbox" id="playlistPrivacy" />
      <label for="playlistPrivacy">Private Playlist</label>
    </div>
    
    <button class="confirm" onclick="savePlaylist()">Save Playlist</button>
    <button class="cancel" onclick="closePlaylistModal()">Cancel</button>
  </div>

  <!-- ------------------ JavaScript ------------------ -->
  <script>
    /* Global variable to store chosen cover image DataURL */
    let playlistCoverUrl = null;

    /* ----- Function to Switch Between Screens ----- */
    function switchScreen(screenId) {
      // Hide all screens first
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('visible');
      });
      // Remove active state from all buttons in the tab bar
      document.querySelectorAll('.tab-bar button').forEach(btn => {
        btn.classList.remove('active');
      });
      // Show the selected screen and mark its button as active
      var selectedScreen = document.getElementById(screenId);
      selectedScreen.classList.add('visible');
      document.getElementById('btn-' + screenId).classList.add('active');
    }

    /* ----- ALBUMS CAROUSEL ----- */
    let currentSlide = 0;
    const slidesContainer = document.getElementById('albumSlides');
    const slides = document.querySelectorAll('.album-carousel .slide');
    const totalSlides = slides.length;
    function showSlide(index) {
      if (index < 0) index = totalSlides - 1;
      if (index >= totalSlides) index = 0;
      currentSlide = index;
      slidesContainer.style.transform = `translateX(-${index * 100}%)`;
    }
    function prevSlide() { showSlide(currentSlide - 1); }
    function nextSlide() { showSlide(currentSlide + 1); }
    setInterval(nextSlide, 4000);

    function filterAlbums() {
      const query = document.getElementById('albumSearch').value.toLowerCase();
      document.querySelectorAll('.album-item').forEach(item => {
        const title = item.getAttribute('data-title').toLowerCase();
        item.style.display = title.indexOf(query) > -1 ? 'block' : 'none';
      });
    }

    /* ----- ALBUM MODAL ----- */
    function openAlbumModal(title, desc) {
      document.getElementById('albumModalTitle').textContent = title;
      document.getElementById('albumDesc').textContent = desc;
      document.getElementById('albumModal').style.display = 'flex';
      document.getElementById('overlay').style.display = 'block';
    }
    function closeAlbumModal() {
      document.getElementById('albumModal').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }
    function playAlbum() {
      alert("Playing album: " + document.getElementById('albumModalTitle').textContent);
      closeAlbumModal();
    }

    /* ----- ARTIST MODAL ----- */
    function openArtistModal(artistName) {
      document.getElementById('artistModalTitle').textContent = artistName;
      const songs = {
        'Artist A': ['Song A1', 'Song A2', 'Song A3'],
        'Artist B': ['Song B1', 'Song B2', 'Song B3'],
        'Artist C': ['Song C1', 'Song C2', 'Song C3']
      };
      const list = document.getElementById('artistSongs');
      list.innerHTML = '';
      (songs[artistName] || ['No songs available']).forEach(song => {
        const li = document.createElement('li');
        li.textContent = song;
        list.appendChild(li);
      });
      document.getElementById('artistModal').style.display = 'flex';
      document.getElementById('overlay').style.display = 'block';
    }
    function closeArtistModal() {
      document.getElementById('artistModal').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }

    /* ----- PLAYLIST MODAL & DRAG & DROP ----- */
    let editingPlaylistId = null;
    function openPlaylistModal() {
      editingPlaylistId = null;
      document.getElementById('playlistModalTitle').textContent = "Create New Playlist";
      document.getElementById('newPlaylistName').value = '';
      document.getElementById('newPlaylistDesc').value = '';
      document.getElementById('newPlaylistCover').value = '';
      document.getElementById('coverPreview').style.display = 'none';
      document.getElementById('coverPreview').style.backgroundImage = '';
      playlistCoverUrl = null; // reset global cover URL
      document.getElementById('newPlaylistGenre').selectedIndex = 0;
      document.getElementById('playlistPrivacy').checked = false;
      document.getElementById('playlistModal').style.display = 'flex';
      document.getElementById('overlay').style.display = 'block';
    }
    function closePlaylistModal() {
      document.getElementById('playlistModal').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';
    }
    function savePlaylist() {
      const name = document.getElementById('newPlaylistName').value.trim();
      const desc = document.getElementById('newPlaylistDesc').value.trim();
      const genre = document.getElementById('newPlaylistGenre').value;
      const privacy = document.getElementById('playlistPrivacy').checked ? " (Private)" : "";
      if (!name) { alert('Please enter a playlist name.'); return; }
      const grid = document.getElementById('playlistsGrid');
      if (editingPlaylistId) {
        // Edit existing playlist
        const card = document.getElementById(editingPlaylistId);
        card.querySelector('h4').textContent = name;
        card.querySelector('p').textContent = desc + (genre ? " - " + genre : "") + privacy;
        // If a new cover was chosen, update the image in the playlist card and the corresponding album card
        if (playlistCoverUrl) {
          let img = card.querySelector('img');
          if (!img) {
            img = document.createElement('img');
            card.insertBefore(img, card.firstChild);
          }
          img.src = playlistCoverUrl;
          img.style.width = "100%";
          img.style.borderRadius = "5px";
          img.style.marginBottom = "8px";
          // Update the corresponding album card if exists
          if (card.dataset.albumCardId) {
            const albumCard = document.getElementById(card.dataset.albumCardId);
            if (albumCard) {
              albumCard.innerHTML = `<img src="${playlistCoverUrl}" style="width:100%; border-radius:5px; margin-bottom:8px;">${name}`;
            }
          }
        }
      } else {
        // Create new playlist card
        const card = document.createElement('div');
        card.className = 'playlist-card';
        card.draggable = true;
        card.id = 'playlist-' + Date.now();
        // Generate an ID for the corresponding album card
        const albumCardId = 'album-' + card.id;
        card.dataset.albumCardId = albumCardId;
        // Build innerHTML with cover image if exists
        let coverHTML = "";
        if (playlistCoverUrl) {
          coverHTML = `<img src="${playlistCoverUrl}" style="width:100%; border-radius:5px; margin-bottom:8px;">`;
        }
        card.innerHTML = `${coverHTML}<button class="edit-btn" onclick="editPlaylist(event, '${card.id}')" aria-label="Edit Playlist">Edit</button>
                          <h4>${name}</h4>
                          <p>${desc}${genre ? " - " + genre : ""}${privacy}</p>`;
        grid.appendChild(card);
        // Also add a corresponding album card to the Albums screen's albumGrid
        const albumCard = document.createElement('div');
        albumCard.className = 'album-item';
        albumCard.id = albumCardId;
        albumCard.setAttribute('data-title', name);
        if (playlistCoverUrl) {
          albumCard.innerHTML = `<img src="${playlistCoverUrl}" style="width:100%; border-radius:5px; margin-bottom:8px;">${name}`;
        } else {
          albumCard.textContent = name;
        }
        document.getElementById('albumGrid').appendChild(albumCard);
      }
      closePlaylistModal();
      // Reset the global cover URL after saving
      playlistCoverUrl = null;
    }
    function editPlaylist(e, playlistId) {
      e.stopPropagation();
      editingPlaylistId = playlistId;
      document.getElementById('playlistModalTitle').textContent = "Edit Playlist";
      const card = document.getElementById(playlistId);
      document.getElementById('newPlaylistName').value = card.querySelector('h4').textContent;
      let text = card.querySelector('p').textContent;
      let isPrivate = text.includes("(Private)");
      text = text.replace(" (Private)", "");
      let parts = text.split(" - ");
      document.getElementById('newPlaylistDesc').value = parts[0] || "";
      if (parts[1]) {
        const genreSelect = document.getElementById('newPlaylistGenre');
        for (let i = 0; i < genreSelect.options.length; i++){
          if (genreSelect.options[i].value === parts[1]){
            genreSelect.selectedIndex = i;
            break;
          }
        }
      } else {
        document.getElementById('newPlaylistGenre').selectedIndex = 0;
      }
      document.getElementById('playlistPrivacy').checked = isPrivate;
      // If the playlist card already has an image, set the global cover URL for potential updating
      const existingImg = card.querySelector('img');
      if (existingImg) {
        playlistCoverUrl = existingImg.src;
        // Also show the preview in the modal
        const preview = document.getElementById('coverPreview');
        preview.style.backgroundImage = `url(${playlistCoverUrl})`;
        preview.style.display = 'block';
      } else {
        playlistCoverUrl = null;
      }
      document.getElementById('playlistModal').style.display = 'flex';
      document.getElementById('overlay').style.display = 'block';
    }
    function allowDrop(ev) { ev.preventDefault(); }
    function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
    function drop(ev) {
      ev.preventDefault();
      const data = ev.dataTransfer.getData("text");
      const draggedElem = document.getElementById(data);
      const target = ev.target.closest('.playlist-card');
      if (target && target.parentElement === document.getElementById('playlistsGrid')) {
        document.getElementById('playlistsGrid').insertBefore(draggedElem, target);
      }
    }
    document.getElementById('playlistsGrid').addEventListener('dragover', allowDrop);
    document.getElementById('playlistsGrid').addEventListener('drop', drop);

    /* ----- Preview Cover Image in Playlist Modal ----- */
    function previewCover(input) {
      const preview = document.getElementById('coverPreview');
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          playlistCoverUrl = e.target.result; // Store the DataURL globally
          preview.style.backgroundImage = `url(${playlistCoverUrl})`;
          preview.style.display = 'block';
        }
        reader.readAsDataURL(input.files[0]);
      } else {
        preview.style.display = 'none';
        playlistCoverUrl = null;
      }
    }
    function closeAllModals() {
      closeArtistModal();
      closePlaylistModal();
      closeAlbumModal();
    }
  </script>
</body>
</html>
